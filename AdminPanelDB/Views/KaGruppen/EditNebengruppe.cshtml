@model AdminPanelDB.Models.Nebengruppe

@if (ViewBag.Error != null)
{
    <p style="color:red; text-align:center; font-weight:bold;">
        @ViewBag.Error
    </p>
}

<h2 style="text-align:center;">Nebengruppe bearbeiten</h2>

<div class="form-container">
    <form asp-action="EditNebengruppe" method="post">
        <input type="hidden" asp-for="Id" />

        <input type="hidden" name="pageSize" value="@ViewBag.PageSize" />
        <input type="hidden" name="pageNumber" value="@ViewBag.PageNumber" />

        <div>
            <label>Kategorie:</label>
            <select asp-for="GehoertZuKategorie"
                    id="kategorieSelect"
                    class="@( (ViewBag.DropdownEnable == true
                                           && Context.Session.GetInt32("IstAdmin") == 1)
                                         ? ""
                                         : "readonly-select")">
                @foreach (var k in ViewBag.Kategorien)
                {
                    <option value="@k.KategorieNummer">
                        @k.Bezeichnung
                    </option>
                }
            </select>
        </div>

        <div>
            <label>Hauptgruppe:</label>
            <select asp-for="GehoertZuHauptgruppe"
                    id="hauptgruppeSelect"
                    class="@( (ViewBag.DropdownEnable == true
                                           && Context.Session.GetInt32("IstAdmin") == 1)
                                         ? ""
                                         : "readonly-select")">
                @foreach (var h in ViewBag.Hauptgruppen)
                {
                    <option value="@h.HauptgruppeNummer">
                        @h.Bezeichnung
                    </option>
                }
            </select>
        </div>

        <div>
            <label asp-for="Bezeichnung">Bezeichnung:</label>
            <input asp-for="Bezeichnung" maxlength="120" />
        </div>

        <div>
            <label asp-for="Kuerzel">Kuerzel:</label>
            <input asp-for="Kuerzel" maxlength="10" />
        </div>

        <div>
            <label asp-for="Beschreibung">Beschreibung:</label>
            <textarea asp-for="Beschreibung" maxlength="280"></textarea>
        </div>


        <div>
            <label asp-for="NebengruppeNummer">NebengruppeNummer:</label>
            <input type="number" asp-for="NebengruppeNummer" />
        </div>

        <div>
            <label asp-for="IstAktiv">IstAktiv:</label>
            <input asp-for="IstAktiv" type="checkbox" />
        </div>

        <div>
            <label asp-for="IstTestGruppe">IstTestGruppe:</label>
            <input asp-for="IstTestGruppe" type="checkbox" />
        </div>

        <button type="submit">Speichern</button>

    </form>
    <a asp-action="KaGruppen"
       asp-route-kategorieNummer="@ViewBag.OriginalKategorie"
       asp-route-pageSize="@ViewBag.PageSize"
       asp-route-pageNumber="@ViewBag.PageNumber">
        Zurück
    </a>

</div>


<script>
       document.getElementById("kategorieSelect").addEventListener("change", function () {

        var kategorieNummer = this.value;

        fetch('/KaGruppen/GetHauptgruppenByKategorie?kategorieNummer=' + kategorieNummer)
            .then(response => response.json())
            .then(data => {
                var hauptSelect = document.getElementById("hauptgruppeSelect");
                hauptSelect.innerHTML = "";

                data.forEach(item => {
                    var opt = document.createElement("option");
                    opt.value = item.hauptgruppeNummer ?? item.HauptgruppeNummer;
                    opt.textContent = item.bezeichnung ?? item.Bezeichnung;
                    hauptSelect.appendChild(opt);
                });

                if (data.length > 0) {
                    hauptSelect.value = data[0].hauptgruppeNummer ?? data[0].HauptgruppeNummer;
                }
            });
    });

    console.log("Model.GehoertZuHauptgruppe =", @Model.GehoertZuHauptgruppe);
    console.log("ViewBag.OriginalHauptgruppe =", @ViewBag.OriginalHauptgruppe);
    console.log("Hauptgruppen loaded =", @ViewBag.Hauptgruppen.Count);
</script>
 